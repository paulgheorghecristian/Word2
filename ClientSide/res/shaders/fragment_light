#version 330 core

layout(location = 0) out vec3 out_light;

uniform sampler2D worldPositionSampler;
uniform sampler2D worldNormalSampler;
uniform vec3 lightPosition;
uniform vec4 colorVector;
uniform int screenWidth, screenHeight;

void main(){
    vec2 texCoord = gl_FragCoord.xy / vec2(screenWidth, screenHeight);

    vec3 worldPosition = texture(worldPositionSampler, texCoord).rgb;
    vec3 worldNormal = texture(worldNormalSampler, texCoord).rgb * 2.0 - vec3(1);

    vec3 dir = lightPosition - worldPosition;
    float strength = max(0.0, dot(normalize(worldNormal), normalize(dir)));

    float l = length(dir);
    float a = 0.6, b = 0.01, c = 0.0001;
    float att = 1.0 / (a + b*l + c * l * l);

    out_light = att * strength  * colorVector.rgb;
}
